var ping_loop,last_scheduler,ping_active=!0;const init_page_asap=function(){apex.theme42.util.configAPEXMsgs({autoDismiss:!0,duration:2300}),apex.message.setThemeHooks({beforeShow:function(e,t){if(e===apex.message.TYPE.ERROR){var o=get_message(t.find("ul.a-Notification-list li").html());if(console.log("MESSAGE.ERROR:",o),"WARNING"==o.status&&t.find(".t-Alert--warning").addClass("t-Alert--yellow"),t.find(".a-Notification-item").first().html(o.message),o.message.toUpperCase().includes("YOUR SESSION HAS ENDED")){ping_active=!1;for(var a=0;a<=ping_loop;a++)clearTimeout(a);apex.item("P0_SESSION_TIMEOUT_URL").getValue()&&(window.location.href=apex.item("P0_SESSION_TIMEOUT_URL").getValue())}}if(e===apex.message.TYPE.SUCCESS){o=get_message($("#APEX_SUCCESS_MESSAGE h2.t-Alert-title").html());console.log("MESSAGE.SUCCESS:",o),$("#APEX_SUCCESS_MESSAGE h2.t-Alert-title").text(o.message),clearTimeout(last_scheduler),last_scheduler=setTimeout((()=>{apex.message.hidePageSuccess()}),2300)}o.action&&(console.log("TRIGGER_ACTION",o.action),$.event.trigger(o.action))},beforeHide:function(e,t){}});var e=parseInt(apex.item("P0_AJAX_PING_INTERVAL").getValue()),t=function(){ping_active&&(console.log("CALL AJAX_PING"),apex.server.process("AJAX_PING",{},{async:!0,dataType:"text",success:function(e){if(e.trim().length>0)try{const t=JSON.parse(e);console.log("PING RECEIVED, JSON",t),show_message(t)}catch(t){console.log("PING RECEIVED, TEXT",e,t),show_message(e)}}}),ping_active&&e>0&&(ping_loop=setTimeout((function(){t()}),1e3*e)))};ping_active&&e>0&&apex.item("P0_AJAX_PING_INTERVAL").node&&(ping_loop=t())},init_page=function(){fix_grid_toolbars(),fix_grid_save_button(),$("body").on("click","button.ACTION_MENU",show_action_menu),$("html").click((function(){$("div.ACTION_MENU").hide()})),$("div.ACTION_MENU a").click((function(e){var t=$(this);console.log("MENU CLICK",t,e)}))};$("button > .t-Button-label").each((function(e,t){$(t).html($(t).html().replace(/\[([^\]]+)\]/,'<div class="BADGE">$1</div>'))})),$((function(){init_page_asap()})),apex.jQuery(window).on("theme42ready",(function(){fix_grid_toolbars(),fix_grid_save_button(),$("body").on("click","button.ACTION_MENU",show_action_menu),$("html").click((function(){$("div.ACTION_MENU").hide()})),$("div.ACTION_MENU a").click((function(e){var t=$(this);console.log("MENU CLICK",t,e)}))}));const show_success=function(e){apex.message.showPageSuccess(JSON.stringify(get_message(e,"SUCCESS")))},show_warning=function(e){apex.message.clearErrors(),apex.message.showErrors([{type:apex.message.TYPE.ERROR,location:["page"],message:JSON.stringify(get_message(e,"WARNING")),unsafe:!1}])},show_error=function(e){apex.message.clearErrors(),apex.message.showErrors([{type:apex.message.TYPE.ERROR,location:["page"],message:JSON.stringify(get_message(e,"ERROR")),unsafe:!1}])},show_message=function(e){e.message&&("SUCCESS"==e.status?show_success(e):"WARNING"==e.status?show_warning(e):show_error(e))},get_message=function(e,t,o){var a={message:e,status:t,action:o};if("object"==typeof e)a.message=e.message?e.message:a.message,a.status=e.status?e.status:a.status,a.action=e.action?e.action:a.action;else if("string"==typeof e&&"{"===e.substring(0,1)&&"}"===e.trim().slice(-1))try{const t=JSON.parse(e);a.message=t.message?t.message:a.message,a.status=t.status?t.status:a.status,a.action=t.action?t.action:a.action}catch(t){console.error("JSON_PARSE_FAILED",e,t)}return a},wait_for_element=function(e,t,o,a){new MutationObserver((function(i){$(e).length&&(o(e,t),a&&observer.disconnect())})).observe(document.getElementById(t),{childList:!0,subtree:!0})},delay=function(e){return new Promise((t=>setTimeout(t,e)))},copy_to_clipboard=function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)},color_cell=function(e,t,o,a,i){return t&&t.length&&(a&&a.length||i&&i.length)?e.defaultGridColumnOptions={cellTemplate:'<div style="background: '+a+"; color: "+i+';" title="'+o+'">'+t+"</div>"}:e.defaultGridColumnOptions={cellTemplate:'<span title="'+o+'">'+t+"</span>"},e},fix_grid_toolbars=function(){$(".a-IG").each((function(){var e=$(this).parent(),t=e.attr("id");e.hasClass("ORIGINAL")||fix_grid_toolbar(t)}))},fix_grid_toolbar=function(e){console.group("FIX_GRID_TOOLBAR",e);var t=$("#"+e),o=apex.region(e).widget(),a=o.interactiveGrid("getActions"),i=o.interactiveGrid("getToolbar"),s=$.apex.interactiveGrid.copyDefaultToolbar(),n=(s.toolbarFind("actions1"),s.toolbarFind("actions2")),r=s.toolbarFind("actions3"),c=s.toolbarFind("actions4");a.hide("reset-report"),a.show("change-rows-per-page");for(var l=0;l<n.controls.length;l++){if("save"==(g=n.controls[l]).action){g.hot=!1,g.label="Save Changes";break}}for(l=0;l<r.controls.length;l++){var g;if("selection-add-row"==(g=r.controls[l]).action){g.icon="fa fa-plus",g.iconOnly=!0,g.label=" ";break}}t.hasClass("SAVE_ALL")&&(a.add({name:"SAVE_ALL",action:function(e,t){var o=e.delegateTarget.id.replace("_ig",""),a=apex.region(o).widget(),i=a.interactiveGrid("getViews","grid").model;console.log("CALL SAVE_ALL",o,a,i),i.forEach((function(e){try{""==i.getValue(e,"MARK_AS_CHANGED")&&i.setValue(e,"MARK_AS_CHANGED","Y ")}catch(e){}})),a.interactiveGrid("getActions").invoke("save"),a.interactiveGrid("getCurrentView").model.fetch()}}),n.controls.push({type:"BUTTON",label:"Save All Rows",id:"save_all_rows",icon:"",action:"SAVE_ALL"})),t.hasClass("SAVE_SELECTED")&&(a.add({name:"SAVE_SELECTED",action:function(e,t){var o,a=e.delegateTarget.id.replace("_ig",""),i=apex.region(a).widget(),s=i.interactiveGrid("getViews","grid").model,n=i.interactiveGrid("getViews").grid,r=i.interactiveGrid("getViews").grid.getSelectedRecords(),c=[];console.log("CALL SAVE_SELECTED",a,i,s);for(var l=0;l<r.length;l++)o=n.model.getRecordId(r[l]),c.push(o);s.forEach((function(e){for(var t=0;t<c.length;t++)if(c[t]==n.model.getRecordId(e))try{""==s.getValue(e,"MARK_AS_CHANGED")&&s.setValue(e,"MARK_AS_CHANGED","Y ")}catch(e){}})),i.interactiveGrid("getActions").invoke("save"),i.interactiveGrid("getCurrentView").model.fetch()}}),n.controls.push({type:"BUTTON",label:"Save Selected",id:"save_all_rows",icon:"",action:"SAVE_SELECTED"})),c.controls.push({type:"BUTTON",action:"refresh",label:"Refresh",icon:"",iconBeforeLabel:!0}),$("#apexDevToolbar.a-DevToolbar")&&c.controls.push({type:"BUTTON",action:"save-report",label:"Save as Default",icon:""}),s.defaultGridViewOptions={persistSelection:!0},i.toolbar("option","data",s),i.toolbar("refresh"),console.groupEnd()},fix_grid_save_button=function(){var e=new MutationObserver((function(e){e.forEach((function(e){var t=$(e.target);t.hasClass("is-active")&&t.parent().parent().find('button.a-Toolbar-item[data-action="save"]').addClass("is-active a-Button--hot")}))}));$.each($('.a-Toolbar-button[name="edit"]'),(function(t,o){$el=$(o),e.observe($el[0],{attributes:!0})}))},fold_grid_group=function(e,t,o){!function a(i){setTimeout((function(){$("#"+e+" table tbody tr button.a-Button.js-toggleBreak").each((function(){if(i>0){$x=$(this);var e=$x.parent().find(".a-GV-controlBreakLabel"),a=e.find(".a-GV-breakLabel").text(),s=e.find(".a-GV-breakValue").text();if(a.startsWith(t)&&s.trim()==o)return $x.click(),$x.blur(),$(window).scrollTop(0),void(i=0)}})),--i&&a(i)}),200)}(10)},process_grid_all_rows=function(e,t,o){var a=apex.region(e).widget().interactiveGrid("getViews","grid").model;a.forEach((function(e,o){try{a.setValue(e,t,a.getValue(e,t)+"!")}catch(e){}})),apex.submit(o)},process_grid_selected_rows=function(e,t,o){for(var a=apex.region(e).widget(),i=a.interactiveGrid("getViews","grid").model,s=a.interactiveGrid("getViews").grid,n=a.interactiveGrid("getViews").grid.getSelectedRecords(),r=[],c=0;c<n.length;c++){var l=s.model.getRecordId(n[c]);r.push(l)}i.forEach((function(e){try{for(var o=0;o<r.length;o++)if(r[o]==s.model.getRecordId(e))try{i.setValue(e,t,"Y")}catch(e){}}catch(e){}})),apex.submit(o)},renumber_grid_rows=function(e,t){var o=apex.region(e).widget().interactiveGrid("getViews","grid").model;o.forEach((function(e,a){var i;try{i=o.setValue(e,t,"#"+a)}catch(t){console.error("ERROR:",a,e,i,t)}}))},show_action_menu=function(e){e.preventDefault(),e.stopPropagation();var t=$(this).attr("id"),o=$("button#"+t).offset();console.log("BUTTON",t,o,"MENU",$("div.ACTION_MENU").offset(),$('div.ACTION_MENU[data-id="'+t+'"]')),$("div.ACTION_MENU").css({display:"none"}),$('div.ACTION_MENU[data-id="'+t+'"]').css({display:"block",position:"fixed",top:o.top,left:o.left})};